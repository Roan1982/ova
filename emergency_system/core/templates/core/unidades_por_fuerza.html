{% extends 'core/base.html' %}
{% block title %}Unidades por Fuerza{% endblock %}
{% block extra_styles %}
 .force { margin-bottom: 20px; }
 table { width: 100%; border-collapse: collapse; }
 th, td { border: 1px solid #1f2937; padding: 8px; }
 th { background: #0b1220; }
 .stats { display: flex; gap: 15px; margin-bottom: 10px; font-size: 13px; }
 .stat-item { background: #0f172a; padding: 8px 12px; border-radius: 6px; }
 .stat-value { font-weight: bold; font-size: 16px; }
 .disponible { color: #22c55e; }
 .en_ruta { color: #f59e0b; }
 .ocupado { color: #ef4444; }
{% endblock %}
{% block content %}
  <h1>üöó Unidades por Fuerza</h1>
  {% for item in data %}
  <div class="force card">
    <h2 style="padding:12px 16px; margin:0; border-bottom:1px solid #1f2937;">
      {{ item.force.name }}
      <span style="font-size: 14px; font-weight: normal; color: var(--muted); margin-left: 10px;">
        ({{ item.stats.total }} unidades - {{ item.stats.porcentaje_disponible }}% disponibles)
      </span>
    </h2>
    <div class="body">
      <!-- Estad√≠sticas r√°pidas -->
      <div class="stats">
        <div class="stat-item">
          <div class="disponible">‚óè Disponibles</div>
          <div class="stat-value">{{ item.stats.disponibles }}</div>
        </div>
        <div class="stat-item">
          <div class="en_ruta">‚óè En Ruta</div>
          <div class="stat-value">{{ item.stats.en_ruta }}</div>
        </div>
        <div class="stat-item">
          <div class="ocupado">‚óè Ocupados</div>
          <div class="stat-value">{{ item.stats.ocupados }}</div>
        </div>
      </div>
      
      <table>
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Estado</th>
            <th>Coordenadas</th>
          </tr>
        </thead>
        <tbody>
          {% for v in item.unidades %}
          <tr>
            <td><strong>{{ v.type }}</strong></td>
            <td>
              <span class="{% if v.status == 'disponible' %}disponible{% elif v.status == 'en_ruta' %}en_ruta{% else %}ocupado{% endif %}">
                ‚óè {{ v.get_status_display|default:v.status|title }}
              </span>
            </td>
            <td>
              {% if v.current_lat and v.current_lon %}
                {{ v.current_lat|floatformat:4 }}, {{ v.current_lon|floatformat:4 }}
              {% else %}
                <span style="color: var(--muted);">Sin ubicaci√≥n</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="3" style="text-align: center; color: var(--muted);">No hay unidades asignadas a esta fuerza.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endfor %}
{% endblock %}
